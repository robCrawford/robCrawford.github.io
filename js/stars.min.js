((W,d,M)=>{
  const p=200,z="068acdef".split(""),sp=-1;
  let a=[],b=[],c=[];
  let cvs=d.createElement("canvas"),ctx=cvs.getContext("2d");
  d.body.appendChild(cvs);
  Object.assign(cvs.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"-1"});
  d.body.style.margin="0";

  const resize=()=>{cvs.width=W.innerWidth;cvs.height=W.innerHeight};
  W.addEventListener("resize",resize);
  resize();

  // Initialize stars
  for(let i=0;i<p;i++){
    a[i]=M.round(M.random()*(cvs.width>>1))-(cvs.width>>2);
    b[i]=M.round(M.random()*(cvs.height>>1))-(cvs.height>>2);
    c[i]=M.round(255*M.random())+1;
  }

  // Ship properties
  let shipX=-100, shipY=cvs.height/2, shipSpeed=8, shipBaseSize=60;
  const rotationAngle = -0.5; // tilt
  let paused = false;

  const cobra3D = [
    [0,0,0],        // nose
    [-0.4,0.3,1],   // right wing top
    [-0.4,-0.3,1],  // right wing bottom
    [-0.8,0.15,2],  // rear right
    [-0.8,-0.15,2], // rear left
    [-0.4,0.3,1],   // left wing top
    [-0.4,-0.3,1],  // left wing bottom
    [0,0,0]         // back to nose
  ];

  const drawShip=()=>{
    if(paused) return;

    const t = shipX / (cvs.width * 0.5); // when to disappear
    const scale = 1 - t;
    if(scale <= 0) {
      paused = true;
      setTimeout(()=>{
        // restart from left at a random vertical position
        shipX = -100;
        shipY = 100 + M.random()*(cvs.height-200);
        paused = false;
      }, 6000);
      return;
    }

    ctx.strokeStyle="#fff";
    ctx.lineWidth=1;
    ctx.beginPath();

    for(let i=0;i<cobra3D.length;i++){
      let [x,y,z] = cobra3D[i];
      const cosR = M.cos(rotationAngle);
      const sinR = M.sin(rotationAngle);
      const rx = x*cosR - y*sinR;
      const ry = x*sinR + y*cosR;

      const px = shipX + (rx * shipBaseSize * scale) / (z/2 + 1);
      const py = shipY + (ry * shipBaseSize * scale) / (z/2 + 1);

      if(i===0) ctx.moveTo(px,py);
      else ctx.lineTo(px,py);
    }
    ctx.stroke();

    shipX += shipSpeed;
  }

  const draw=()=>{
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,cvs.width,cvs.height);

    for(let i=0;i<p;i++){
      c[i]=(c[i]-sp+255)%255||-sp;
      let fx=255*a[i]/c[i]+(cvs.width>>1), fy=255*b[i]/c[i]+(cvs.height>>1);
      if(fx>-50 && fx<cvs.width+50 && fy>-50 && fy<cvs.height+50){
        let m=(255-c[i])>>5;
        ctx.fillStyle=`#${z[m]}${z[m]}${z[m]}`;
        ctx.fillRect(fx,fy,2,2);
      }
    }

    drawShip();
    W.requestAnimationFrame(draw);
  };
  draw();
})(window,document,Math);
